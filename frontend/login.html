<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krishi AI - Farmer Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Animated background pattern -->
    <div class="bg-pattern"></div>
    
    <!-- Decorative leaves -->
    <div class="leaf-decoration" style="top: 10%; left: 5%; font-size: 60px;">üçÉ</div>
    <div class="leaf-decoration" style="top: 20%; right: 10%; font-size: 40px; animation-delay: 1s;">üåø</div>
    <div class="leaf-decoration" style="bottom: 20%; left: 15%; font-size: 50px; animation-delay: 2s;">üå±</div>
    <div class="leaf-decoration" style="bottom: 10%; right: 8%; font-size: 30px; animation-delay: 0.5s;">üçÇ</div>

    <div class="glass-card fade-in">
        <div class="login-header">
            <div class="logo">
                <i class="fas fa-seedling"></i>
            </div>
            <h1>Welcome to Krishi AI</h1>
            <p class="tagline">Your Smart Agriculture Assistant</p>
        </div>

        <form id="loginForm" class="login-form">
            <div class="input-group">
                <label for="username"><i class="fas fa-user"></i> Username</label>
                <div class="input-icon">
                    <i class="fas fa-user"></i>
                    <input type="text" id="username" required placeholder="Enter your username"/>
                </div>
            </div>

            <div class="input-group">
                <label for="password"><i class="fas fa-lock"></i> Password</label>
                <div class="input-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="password" required placeholder="Enter your password"/>
                </div>
            </div>

            <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Login to Your Farm
            </button>
        </form>

        <div class="register-link">
            <p>New to Krishi AI? <a href="register.html">Create an account <i class="fas fa-arrow-right"></i></a></p>
        </div>

        <div id="loginStatus"></div>
        <div class="growing-bar"></div>
    </div>

    <script>
        const loginForm = document.getElementById("loginForm");
        const loginStatus = document.getElementById("loginStatus");
        const growingBar = document.querySelector(".growing-bar");
        
        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            
            // Show loading animation
            growingBar.style.display = "block";
            growingBar.style.animation = "grow 2s forwards";
            
            // Clear previous status
            loginStatus.className = "";
            loginStatus.textContent = "";
            
            try {
                const res = await fetch("http://127.0.0.1:8000/auth/login", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    credentials: "include",
                    body: JSON.stringify({username, password})
                });
                
                const data = await res.json();
                
                // Hide loading animation
                growingBar.style.display = "none";
                
                if(res.status === 200){
                    loginStatus.textContent = "Login successful! Redirecting...";
                    loginStatus.className = "success";
                    
                    // rely on http-only cookie, no localStorage for auth
                    
                    // Redirect after a brief delay
                    setTimeout(() => {
                        window.location.href = "index.html";
                    }, 1500);
                } else {
                    loginStatus.textContent = data.detail || "Login failed. Please check your credentials.";
                    loginStatus.className = "error";
                }
            } catch(err) {
                console.error(err);
                growingBar.style.display = "none";
                loginStatus.textContent = "Error connecting to server. Please try again.";
                loginStatus.className = "error";
            }
        });
    </script>
</body>
</html>